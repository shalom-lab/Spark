[
    {
        "id": "bookmark-storage",
        "title": "书签存取信息",
        "lang": "JS",
        "code": "// ==================== 书签存取信息 ====================\n// 核心思路：通过 URL hash 传递配置信息，实现 localStorage 数据的便捷存取\n// 适用场景：需要将配置信息保存为书签，下次使用时自动恢复配置\n\n// ========== 第一部分：生成书签链接（保存配置到 URL） ==========\nconst generateBookmark = () => {\n    // 1. 准备要保存的配置数据（可以是任何需要持久化的数据）\n    // 格式：用分隔符（如 |）连接多个配置项\n    const configData = {\n        token: 'ghp_xxxxxx',\n        repo: 'username/repo'\n    };\n    \n    // 2. 将配置对象转换为字符串格式\n    // 方式1：使用分隔符连接（适合简单数据）\n    const raw = `${configData.token}|${configData.repo}`;\n    \n    // 方式2：使用 JSON.stringify（适合复杂对象）\n    // const raw = JSON.stringify(configData);\n    \n    // 3. 使用 base64 编码，确保可以在 URL 中安全传输\n    const encoded = btoa(raw);\n    // 注意：btoa 只支持 ASCII，如果包含中文需要使用 encodeURIComponent + btoa\n    \n    // 4. 构建完整的书签 URL\n    const baseUrl = window.location.href.split('#')[0];\n    const bookmarkUrl = `${baseUrl}#setup=${encodeURIComponent(encoded)}`;\n    \n    // 5. 返回或显示给用户复制\n    return bookmarkUrl;\n    // 用户操作：复制链接 -> 浏览器书签栏 -> 添加书签 -> 粘贴到\"网址\"栏\n};\n\n// ========== 第二部分：从 URL hash 读取配置并保存到 localStorage ==========\nconst restoreFromBookmark = () => {\n    // 1. 读取 URL hash（# 后面的部分）\n    const hash = window.location.hash;\n    \n    // 2. 检查是否符合约定的格式（如 #setup=...）\n    if (hash.startsWith('#setup=')) {\n        try {\n            // 3. 提取并解码配置信息\n            const encoded = decodeURIComponent(hash.split('=')[1]);\n            const raw = atob(encoded);\n            \n            // 4. 解析配置数据\n            // 方式1：使用分隔符拆分（对应方式1的保存）\n            if (raw.includes('|')) {\n                const [token, repo] = raw.split('|');\n                // 保存到 localStorage\n                localStorage.setItem('spark_token', token);\n                localStorage.setItem('spark_repo', repo);\n            }\n            \n            // 方式2：使用 JSON.parse（对应方式2的保存）\n            // const configData = JSON.parse(raw);\n            // Object.entries(configData).forEach(([key, value]) => {\n            //     localStorage.setItem(`config_${key}`, value);\n            // });\n            \n            // 5. 清除 URL hash，保持 URL 干净（可选）\n            setTimeout(() => {\n                history.replaceState(null, document.title, window.location.pathname);\n            }, 2000);\n            \n            return true;\n        } catch (e) {\n            console.error('恢复配置失败:', e);\n            return false;\n        }\n    }\n    return false;\n};\n\n// ========== 使用示例 ==========\n// 页面加载时自动检查并恢复配置\nwindow.addEventListener('load', () => {\n    restoreFromBookmark();\n});\n\n// ========== 核心优势 ==========\n// 1. 无需服务器：配置信息完全存储在 URL 中\n// 2. 跨设备同步：通过书签可以在不同设备间同步配置\n// 3. 便捷恢复：点击书签即可自动恢复，无需手动输入\n// 4. 安全传输：base64 编码确保 URL 安全（注意：不是加密，只是编码）\n// 5. 持久化：恢复后保存到 localStorage，即使清除 URL hash 也能保留\n\n// ========== 扩展思路 ==========\n// 1. 可以添加加密层：使用 AES 加密后再 base64 编码（需要主密码）\n// 2. 可以支持多个配置项：使用 JSON 格式存储复杂对象\n// 3. 可以添加过期时间：在配置数据中包含时间戳，检查是否过期\n// 4. 可以添加校验：使用 hash 或签名验证配置完整性",
        "tags": [
            "url-hash",
            "localstorage",
            "配置项"
        ],
        "createdAt": 1704067200000
    }
]